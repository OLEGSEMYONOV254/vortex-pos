<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</title>
    <style>


        body { font-family: sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f2f2f2; }
        .actions { display: flex; gap: 5px; }
        .add-form { margin: 20px 0; padding: 20px; background: #f5f5f5; }

        .glow-text { text-align: center; color: #00ffcc; grid-column: 1 / -1; }
        .nav-grid {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-around;
          background: #2a2a2a;
          padding: 10px;
          grid-column: 1 / -1;
          margin-bottom: 15px;
        }
        .nav-card {
          padding: 10px 15px;
          background: #3a3a3a;
          color: white;
          text-decoration: none;
          margin: 5px;
          border-radius: 5px;
          text-align: center;
          flex: 1 1 40%;
          transition: background 0.2s ease;
        }
        .nav-card:hover { background: #444; }
        .product-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 10px;
          grid-column: 1;
        }
    </style>
</head>
<body>
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏</h1>

    <nav class="nav-grid">
    <a href="/" class="nav-card">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="/products" class="nav-card">üì¶ –¢–æ–≤–∞—Ä—ã</a>
    <a href="/kassa" class="nav-card">üíµ –ö–∞—Å—Å–∞</a>
    <a href="/counterparties" class="nav-card" >üë• –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã</a>
    <a href="/stats" class="nav-card">üìä –û—Ç—á—ë—Ç—ã</a>
  </nav>

    <div class="add-form">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</h2>
        <form id="addCounterpartyForm">
            <input type="text" name="name" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ" required>
            <input type="text" name="bin" placeholder="–ë–ò–ù">
            <select name="type" required>
                <option value="supplier">–ü–æ—Å—Ç–∞–≤—â–∏–∫</option>
                <option value="buyer">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</option>
                <option value="partner">–ü–∞—Ä—Ç–Ω–µ—Ä</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
            <input type="text" name="address" placeholder="–ê–¥—Ä–µ—Å">
            <input type="text" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
            <input type="email" name="email" placeholder="Email">
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                <th>–ë–ò–ù</th>
                <th>–¢–∏–ø</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for counterparty in counterparties %}
            <tr>
                <td>{{ counterparty.id }}</td>
                <td>{{ counterparty.name }}</td>
                <td>{{ counterparty.bin or '' }}</td>
                <td>
                    {% if counterparty.type == 'supplier' %}–ü–æ—Å—Ç–∞–≤—â–∏–∫
                    {% elif counterparty.type == 'buyer' %}–ü–æ–∫—É–ø–∞—Ç–µ–ª—å
                    {% elif counterparty.type == 'partner' %}–ü–∞—Ä—Ç–Ω–µ—Ä
                    {% else %}–î—Ä—É–≥–æ–µ{% endif %}
                </td>
                <td>{{ counterparty.phone or '' }}</td>
                <td>{{ counterparty.created_at }}</td>
                <td class="actions">
                    <button onclick="editCounterparty({{ counterparty.id }})">‚úèÔ∏è</button>
                    <button onclick="deleteCounterparty({{ counterparty.id }})">üóëÔ∏è</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        document.getElementById('addCounterpartyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/counterparties', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                }
            } catch (err) {
                alert(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`);
            }
        });

        function editCounterparty(id) {
            alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ ${id} - —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ`);
        }

        async function deleteCounterparty(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞?')) return;

            try {
                const response = await fetch(`/api/counterparties/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                }
            } catch (err) {
                alert(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}`);
            }
        }
    </script>
</body>
</html>