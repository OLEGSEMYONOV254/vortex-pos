<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Касса</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    .header {
      background: #2c3e50;
      color: white;
      padding: 10px;
      text-align: center;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
      gap: 10px;
    }
    .panel {
      background: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 10px;
      flex: 1;
      min-width: 300px;
    }
    .search-box {
      margin-bottom: 10px;
    }
    .search-box input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    .product-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      max-height: 60vh;
      overflow-y: auto;
    }
    .product-card {
      border: 1px solid #eee;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .product-card:hover {
      background: #f9f9f9;
    }
    .product-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .product-price {
      color: #27ae60;
    }
    .cart {
      min-width: 300px;
    }
    .cart-items {
      max-height: 50vh;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .cart-total {
      font-weight: bold;
      font-size: 18px;
      text-align: right;
      padding: 10px 0;
    }
    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 5px;
    }
    .btn:hover {
      background: #2980b9;
    }
    .btn-danger {
      background: #e74c3c;
    }
    .btn-danger:hover {
      background: #c0392b;
    }
    .btn-success {
      background: #27ae60;
    }
    .btn-success:hover {
      background: #219955;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .quantity-controls button {
      background: #eee;
      border: none;
      width: 25px;
      height: 25px;
      border-radius: 3px;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 5px;
      width: 90%;
      max-width: 400px;
    }
    @media (max-width: 768px) {
      .product-list {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Кассовый аппарат</h1>
  </div>
  
  <div class="container">
    <div class="panel products-panel">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Поиск товаров..." oninput="searchProducts()">
      </div>
      <div class="product-list" id="productList"></div>
    </div>
    
    <div class="panel cart">
      <h2>Текущий чек</h2>
      <div class="cart-items" id="cartItems"></div>
      <div class="cart-total">Итого: <span id="totalAmount">0</span> ₸</div>
      <button class="btn btn-success" onclick="processPayment()">Оплатить</button>
      <button class="btn btn-danger" onclick="clearCart()">Очистить</button>
    </div>
  </div>

  <!-- Модальное окно количества -->
  <div id="quantityModal" class="modal">
    <div class="modal-content">
      <h3 id="modalProductName"></h3>
      <p>Введите количество:</p>
      <input type="number" id="quantityInput" value="1" min="0.1" step="0.1" style="width: 100%; padding: 10px; font-size: 16px;">
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button class="btn" onclick="addToCartWithQuantity()">Добавить</button>
        <button class="btn btn-danger" onclick="closeQuantityModal()">Отмена</button>
      </div>
    </div>
  </div>

  <!-- Модальное окно оплаты -->
  <div id="paymentModal" class="modal">
    <div class="modal-content">
      <h3>Оплата</h3>
      <p>Сумма: <span id="paymentTotal">0</span> ₸</p>
      <div style="margin: 15px 0;">
        <label>Способ оплаты:</label>
        <select id="paymentMethod" style="width: 100%; padding: 8px; margin-top: 5px;">
          <option value="cash">Наличные</option>
          <option value="card">Карта</option>
          <option value="transfer">Перевод</option>
        </select>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="btn btn-success" onclick="confirmPayment()">Подтвердить</button>
        <button class="btn btn-danger" onclick="closePaymentModal()">Отмена</button>
      </div>
    </div>
  </div>

  <script>
    // Данные
    let cart = [];
    let allProducts = [];
    let currentProduct = null;

    // Загрузка товаров (замените на ваш API)
    async function loadProducts() {
      try {
        const response = await fetch('/api/your-products');
        allProducts = await response.json();
        renderProducts(allProducts);
      } catch (error) {
        console.error('Ошибка загрузки товаров:', error);
      }
    }
        
        // Временные тестовые данные
        allProducts = [
          {id: 1, name: "Молоко 1л", price: 500, barcode: "200000000001"},
          {id: 2, name: "Хлеб белый", price: 150, barcode: "200000000002"},
          {id: 3, name: "Яйца 10шт", price: 450, barcode: "200000000003"},
          {id: 4, name: "Сахар 1кг", price: 350, barcode: "200000000004"},
          {id: 5, name: "Масло сливочное", price: 800, barcode: "200000000005"},
          {id: 6, name: "Чай черный", price: 250, barcode: "200000000006"},
          {id: 7, name: "Кофе молотый", price: 1200, barcode: "200000000007"},
          {id: 8, name: "Печенье", price: 300, barcode: "200000000008"},
        ];
        
        renderProducts(allProducts);
      } catch (error) {
        console.error('Ошибка загрузки товаров:', error);
      }
    }

    // Отображение товаров
    function renderProducts(products) {
      const productList = document.getElementById('productList');
      productList.innerHTML = '';
      
      if (products.length === 0) {
        productList.innerHTML = '<p>Товары не найдены</p>';
        return;
      }
      
      products.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="product-name">${product.name}</div>
          <div class="product-price">${product.price} ₸</div>
        `;
        card.onclick = () => showQuantityModal(product);
        productList.appendChild(card);
      });
    }

    // Поиск товаров
    function searchProducts() {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const filtered = allProducts.filter(p => 
        p.name.toLowerCase().includes(term) || 
        p.barcode.includes(term)
      );
      renderProducts(filtered);
    }

    // Работа с корзиной
    function updateCartDisplay() {
      const cartItems = document.getElementById('cartItems');
      const totalAmount = document.getElementById('totalAmount');
      cartItems.innerHTML = '';
      
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div>
            ${item.name} (${item.price} ₸ × ${item.quantity})
          </div>
          <div class="quantity-controls">
            <button onclick="changeQuantity(${item.id}, -1)">-</button>
            <button onclick="changeQuantity(${item.id}, 1)">+</button>
            <button onclick="removeFromCart(${item.id})">×</button>
          </div>
        `;
        cartItems.appendChild(cartItem);
      });
      
      totalAmount.textContent = total.toFixed(2);
    }

    function addToCart(product, quantity = 1) {
      const existingItem = cart.find(item => item.id === product.id);
      
      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          quantity: quantity
        });
      }
      
      updateCartDisplay();
    }

    function changeQuantity(productId, delta) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) {
          cart = cart.filter(i => i.id !== productId);
        }
        updateCartDisplay();
      }
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      updateCartDisplay();
    }

    function clearCart() {
      cart = [];
      updateCartDisplay();
    }

    // Модальные окна
    function showQuantityModal(product) {
      currentProduct = product;
      document.getElementById('modalProductName').textContent = product.name;
      document.getElementById('quantityInput').value = '1';
      document.getElementById('quantityModal').style.display = 'flex';
    }

    function closeQuantityModal() {
      document.getElementById('quantityModal').style.display = 'none';
    }

    function addToCartWithQuantity() {
      const quantity = parseFloat(document.getElementById('quantityInput').value);
      if (quantity > 0) {
        addToCart(currentProduct, quantity);
        closeQuantityModal();
      }
    }

    function processPayment() {
      if (cart.length === 0) {
        alert('Добавьте товары в чек');
        return;
      }
      
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      document.getElementById('paymentTotal').textContent = total.toFixed(2);
      document.getElementById('paymentModal').style.display = 'flex';
    }

    function closePaymentModal() {
      document.getElementById('paymentModal').style.display = 'none';
    }

    function confirmPayment() {
      const paymentMethod = document.getElementById('paymentMethod').value;
      const total = parseFloat(document.getElementById('paymentTotal').textContent);
      
      // Здесь должна быть отправка данных на сервер
      alert(`Оплата на сумму ${total} ₸ (${paymentMethod}) проведена!`);
      
      // Очищаем корзину после оплаты
      clearCart();
      closePaymentModal();
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      
      // Фокус на поиск при загрузке
      document.getElementById('searchInput').focus();
    });
  </script>
</body>
</html>
